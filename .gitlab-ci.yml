before_script:
  - . /afs/cern.ch/lhcb/software/releases/LBSCRIPTS/dev/InstallArea/scripts/LbLogin.sh
  - unset VERBOSE
  - export PATH=/afs/cern.ch/sw/lcg/contrib/ninja/1.4.0/x86_64-slc6:${PATH}
  - ln -sf Makefile-cmake.mk Makefile
  - echo 'set(CMAKE_USE_CCACHE ON CACHE BOOL "")' >> cache_preload.cmake

stages:
  - build
  - test
  - deploy

build:
  stage: build
  tags:
    - slc6
  script:
    - make
  tags:
    - slc6

coding-conventions:
  stage: test
  tags:
    - slc6
  script:
    - make apply-formatting
    - git diff --stat --exit-code

doxygen:
  stage: deploy
  tags:
    - slc6
  script:
    - make
    - make doc
    - mv build.${CMTCONFIG}/doxygen .
  artifacts:
    paths:
      - doxygen/
